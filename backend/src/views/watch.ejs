<video id="player" width="800" controls>
  <source src="/stream/<%= movie._id %>" type="video/mp4" />
</video>

<script>
  const video = document.getElementById("player");
  const movieId = "<%= movie._id %>";

  // Load last progress
  fetch(`/watch/progress/${movieId}`)
    .then((res) => res.json())
    .then((data) => {
      if (data.lastTime > 0) {
        video.currentTime = data.lastTime;
      }
    });

  // Save progress every 5 seconds
  setInterval(() => {
    fetch("/watch/progress", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        movieId,
        currentTime: video.currentTime,
        completed: video.ended,
      }),
    });
  }, 5000);
</script>
